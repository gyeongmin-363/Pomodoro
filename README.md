# ✈️ 픽뽀 - 비행기와 함께하는 픽셀 뽀모도로 앱

## 🎯 한 문장 요약
**“정적 세계지도 기반, 전 세계 사용자 존재감을 점/비행기와 점선으로 시각화하고, 버튼 클릭으로 전체 지도 ↔ 내 위치 보기 시점을 전환하며, 내 위치 보기에서는 항상 내 비행기 위치를 따라가는 항공사 테마 뽀모도로 앱”**

---

## 1️⃣ 핵심 컨셉
- **목표:** 전 세계 사용자와 함께 집중하고 있다는 느낌 제공
- **테마:** 항공사
- **경험:**
    - **집중 세션 = 비행:** 출발 → 비행 → 착륙/휴식
    - **시각화:** 지도 위 비행기/점으로 사용자 존재감 표시

---

## 2️⃣ 지도 및 시각화
- **배경 지도:** 정적 세계지도 이미지 (Equirectangular projection, PNG/SVG)
- **좌표계:** 월드 좌표계 기반, 이미지 픽셀 비율로 점/비행기 위치 설정
- **표시 요소:**
    - **점:** 다른 사용자의 위치
    - **점선:** 비행 경로 또는 집중 세션 연결
    - **비행기 아이콘:** 진행 중인 내 위치 표시

---

## 3️⃣ 시점 전환 (버튼 기반)
- **두 가지 시점:**
    - **전체 지도 보기:** 세계지도 전체 표시, 모든 사용자 점/비행기 표시
    - **내 위치 보기:** 항상 내 비행기 위치를 화면 중앙으로 따라감 (줌 레벨 고정)
- **전환 방식:** 화면 버튼 클릭 (부드러운 애니메이션 적용: `animateFloatAsState` / `animateOffsetAsState`)
- **🚫 미사용:** 드래그/핀치 줌

---

## 4️⃣ 사용자 연결 방식 (간접적)
- **직접적 소셜 연결 없음 (채팅, 친구 추가 X)**
- **간접적 연결:**
    - 지도 상의 다른 사용자 점/비행기로 존재감 전달
    - 점선, 비행기 이동 등으로 “같이 집중하고 있다”는 느낌 유지

---

## 5️⃣ 애니메이션 및 UX
- **비행 경로 애니메이션:** 출발점 → 도착점 사이 점선 따라 비행기 아이콘 이동 (여러 사용자 동시 표시)
- **내 위치 보기:** 내 비행기 위치를 중심으로 지도 및 다른 요소들 함께 이동 (줌 고정)
- **전체 지도 보기:** 세계 지도 전체 비율 유지, 확대/축소 없음

---

## 6️⃣ 기술적 접근
- **UI:** Jetpack Compose Canvas 기반
- **렌더링:** 지도 이미지 위에 점, 점선, 비행기 아이콘 렌더링
- **변환:** `graphicsLayer` 또는 `drawWithContent` 사용
- **좌표 변환:** 월드 좌표 → 화면 좌표 (Offset/Scale 변경으로 시점 전환 구현)
- **육지 좌표 처리:** 미리 정의된 도시 리스트에서 랜덤 선택 (바다 위 위치 방지)

---

## 7️⃣ UX 핵심 포인트
- **시각화:** 전 세계 사용자의 동시 집중 상태 시각화
- **은유:** 집중 시간 = 비행 거리, 진행 상태 = 비행기 위치
- **단순 조작:** 버튼 기반 시점 전환으로 명확한 사용자 의도 반영
- **몰입감:** '내 위치 보기' 시 자동 카메라 추적으로 몰입감 강화
- **부담 없는 연결:** 경쟁 압박 없이 간접적으로 존재감 전달

---
---

## 🛠️ 개발 가이드 체크리스트

### 1. 🗺️ 지도 및 기본 리소스
- [ ] 정적 세계지도 이미지 (Equirectangular projection) 리소스 추가 (PNG 또는 SVG)
- [ ] 비행기 아이콘 이미지 리소스 추가 (내 위치 표시용)
- [ ] 다른 사용자 표시용 점(Dot) 디자인 정의 (색상, 크기)
- [ ] 비행 경로 표시용 점선(Dashed line) 스타일 정의

### 2. 📍 좌표계 및 위치 정의
- [ ] 지도 이미지의 픽셀(Offset)을 월드 좌표(위도/경도)로 변환하거나, 혹은 그 반대로 변환하는 유틸리티 함수 구현
- [ ] `Equirectangular projection` 특성에 맞는 좌표 계산식 확인
    - `x = (longitude + 180) * (imageWidth / 360)`
    - `y = (90 - latitude) * (imageHeight / 180)`
- [ ] 바다 위에 점이 찍히지 않도록, 주요 도시/육지 좌표 리스트 (위도/경도) 미리 정의 (e.g., `cities.json` 또는 `object` 파일)
- [ ] 집중 세션 시작 시(출발), 미리 정의된 도시 리스트에서 출발지/도착지 랜덤 선택 로직 구현

### 3. 🎨 Canvas 기본 렌더링
- [ ] `Canvas` 컴포저블을 화면에 배치
- [ ] `drawImage`를 사용하여 정적 세계지도 이미지를 배경으로 그리기
- [ ] 다른 사용자 위치(점)를 `drawCircle`로 그리기 (Mock 데이터 우선 사용)
- [ ] 내 위치(비행기 아이콘)를 `drawImage` 또는 `drawIcon`으로 그리기

### 4. ✈️ 비행 상태 및 애니메이션
- [ ] 뽀모도로 타이머 상태(집중/휴식)와 비행 상태(출발/비행/착륙) 연결
    - `집중 시작` → `출발` (출발지에 비행기 표시)
    - `집중 중` → `비행` (출발지에서 도착지로 비행기/점선 이동)
    - `집중 완료/휴식 시작` → `착륙` (도착지 도착)
- [ ] `animateFloatAsState` 또는 유사한 API를 사용하여 비행 진행률(0.0f ~ 1.0f) 상태 관리
- [ ] 비행 진행률에 따라 출발지와 도착지 사이의 좌표를 계산(선형 보간)하여 비행기 아이콘 위치 실시간 업데이트
- [ ] `PathEffect.dashPathEffect`를 사용하여 출발지-도착지 간 점선 경로 그리기
- [ ] (선택) 비행기가 경로를 따라 이동할 때 점선도 함께 그려지는 애니메이션 구현

### 5. 🎥 시점 전환 (핵심 기능)
- [ ] `ViewModel` 또는 `StateHolder`에서 현재 시점(`ViewMode.FULL_MAP` / `ViewMode.MY_LOCATION`) 상태 관리
- [ ] 시점 전환 버튼 UI 구현 (e.g., `FloatingActionButton` 또는 `IconToggleButton`)
- [ ] `graphicsLayer` 또는 `drawWithContent`의 `scale` 및 `offset` 파라미터 사용 준비
- [ ] `animateFloatAsState` (Scale 용) 및 `animateOffsetAsState` (Offset/Translate 용)를 사용하여 부드러운 전환 구현

#### 5-1. [전체 지도 보기] 상태
- [ ] `scale`: 지도가 화면에 꽉 차도록 계산된 값 (고정)
- [ ] `offset`: 지도가 화면 중앙에 오도록 (0, 0) 또는 계산된 중앙값 (고정)
- [ ] 이 상태에서 모든 점과 비행기가 축소된 비율로 표시되어야 함

#### 5-2. [내 위치 보기] 상태
- [ ] `scale`: 확대된 줌 레벨 (고정값, 예: 3.0f)
- [ ] `offset`: **(중요)** 내 비행기 아이콘의 현재 *화면 좌표*를 계산하고, 그 위치가 *화면 중앙*에 오도록 `offset` 값을 동적으로 계산
    - `targetOffset = (screenCenter - airplaneScreenPosition) * scale`
- [ ] `animateOffsetAsState`의 `targetValue`를 이 `targetOffset`으로 설정

### 6. 📸 카메라 자동 추적 (내 위치 보기)
- [ ] [내 위치 보기] 모드일 때, 뽀모도로 타이머가 진행(비행)됨에 따라 비행기 위치가 변경됨
- [ ] 비행기 위치가 변경될 때마다 5-2에서 계산한 `targetOffset` 값이 자동으로 업데이트되어야 함
- [ ] `animateOffsetAsState`가 이 변경 사항을 감지하고 카메라(Canvas의 offset)를 부드럽게 패닝(panning)하여 비행기를 계속 중앙에 유지

### 7. 🔒 사용자 입력 제한
- [ ] `Canvas`의 `pointerInput` 수정자(modifier)에서 `detectDragGestures` 및 `detectTransformGestures` (핀치 줌)를 **사용하지 않음** 또는 비활성화
- [ ] 오직 버튼 클릭을 통해서만 시점 전환(Zoom/Pan)이 발생하도록 보장

### 8. 🌐 (선택) 데이터 연동
- [ ] Supabase 또는 Firebase의 실시간 기능을 사용하여 다른 사용자들의 현재 비행 상태(출발지, 도착지, 진행률) 데이터 구독
- [ ] 구독한 데이터를 바탕으로 지도 위에 다른 사용자들의 점/비행기/점선 실시간 렌더링
